!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","stratus.services.registry","stratus.services.createNewSite","stratus.services.utility"],factory):factory(root.Stratus,root._,root.angular)}(this,function(Stratus,_,angular){Stratus.Controllers.CreateNewSite=["$scope","$element","$log","$parse","Registry","createNewSite","utility",function($scope,$element,$log,$parse,Registry,createNewSite,utility){Stratus.Instances[_.uniqueId("createNewSite_")]=$scope,$scope.registry=new Registry,$scope.registry.fetch($element,$scope),$scope.Stratus=Stratus,$scope._=_,$scope.setUrlParams=function(options){if(angular.isObject(options)){var substance=!1;angular.forEach(options,function(value){angular.isDefined(value)&&null!==value&&(angular.isString(value)?value.length>0&&(substance=!0):substance=!0)}),substance&&window.location.replace(Stratus.Internals.SetUrlParams(options))}},$scope.$log=$log,$scope.errorMsg=null,$scope.steps={isWelcome:!0,isThemeSelecting:!1,isSuccess:!1,isBillingPackage:!1},$scope.isArray=angular.isArray,$scope.isDate=angular.isDate,$scope.isDefined=angular.isDefined,$scope.isElement=angular.isElement,$scope.isFunction=angular.isFunction,$scope.isNumber=angular.isNumber,$scope.isObject=angular.isObject,$scope.isString=angular.isString,$scope.isUndefined=angular.isUndefined,$scope.currentMethod=!1,$scope.$watch("model.data",function(modelData){angular.isObject(modelData)&&($scope.currentMethod=modelData.masterContentMethod)}),$scope.stepFinish=function(name){switch(name){case"ThemeSelecting":$scope.steps.isThemeSelecting=!1,$scope.steps.isSuccess=!0;break;case"Success":$scope.steps.isSuccess=!1,$scope.steps.isBillingPackage=!0}},$scope.createSite=function(siteTitle,siteGenreId,masterSite,masterContentMethod){var data={name:siteTitle,genre:siteGenreId,masterSite:masterSite,masterContentMethod:masterContentMethod};createNewSite.create(data).then(function(res){utility.getStatus(res).code===utility.RESPONSE_CODE.success?($scope.errorMsg=null,$scope.steps.isWelcome=!1,res.data.payload&&(window.location.href="/Site/Edit?id="+res.data.payload.id)):$scope.errorMsg=utility.getStatus(res).message})},$scope.checkMasterSite=function(genreId,masterSite){if(masterSite&&genreId){var data={genreId:genreId,isMasterSite:masterSite};createNewSite.checkMaster(data).then(function(res){utility.getStatus(res).code===utility.RESPONSE_CODE.success?$scope.errorMsg=utility.getStatus(res).message:$scope.errorMsg=null})}else $scope.errorMsg=null},$scope.choosePackage=function(){$scope.steps.isSuccess=!1,$scope.steps.isBillingPackage=!0}}]});