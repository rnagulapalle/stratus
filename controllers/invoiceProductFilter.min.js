!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular"],factory):factory(root.Stratus,root._,root.angular)}(this,function(Stratus,_,angular){Stratus.Controllers.InvoiceProductFilter=["$scope","$log",function($scope,$log){function filter(type,data){$scope.collection.meta.set(type,data),$scope.collection.meta.set("api.options.limit",1e3),$scope.collection.fetch().then(function(response){$log.log("response:",response)})}function setAttribute(attribute,value,collection){(collection=collection||$scope.collection).meta.set(attribute,value)}Stratus.Instances[_.uniqueId("invoice_product_filter_")]=$scope,$scope.Stratus=Stratus,$scope._=_,$scope.timeStart=null,$scope.timeEnd=null,$scope.status=[{desc:"Cancelled",value:-1},{desc:"Active",value:1},{desc:"Pending Activation",value:0}],$scope.showOnly=[],$scope.billingIncrementOptions={i:"Minutely",h:"Hourly",d:"Daily",w:"Weekly",m:"Monthly",q:"Quarterly",y:"Yearly"},$scope.toggle=function(value){var index=$scope.showOnly.indexOf(value);-1!==index?$scope.showOnly.splice(index,1):$scope.showOnly.push(value),filter("api.options.invoiceStatus",$scope.showOnly)},$scope.getStatus=function(invoiceProduct){var currentTime=(new Date).getTime()/1e3;if(invoiceProduct){var timeEnd=invoiceProduct.timeEnd?invoiceProduct.timeEnd:currentTime+1e3,timeStart=invoiceProduct.timeStart||currentTime+1e3;return timeEnd<=currentTime?"cancelled":currentTime<timeStart?"pendingActivation":timeStart<=currentTime&&currentTime<=timeEnd?"active":void 0}},$scope.filterSite=function(siteId){filter("api.options.siteId",siteId|=null)},$scope.filterProduct=function(productContentId){filter("api.options.productContentId",productContentId|=null)},$scope.filterDateRanger=function(){var options=$scope.collection.meta.get("api.options");options&&options.timeStart&&delete options.timeStart,options&&options.timeEnd&&delete options.timeEnd,$scope.timeStart&&(angular.isDate($scope.timeStart)&&($scope.timeStart=new Date($scope.timeStart).setHours(0,0,0,0)/1e3),setAttribute("api.options.timeStart",$scope.timeStart)),$scope.timeEnd&&(angular.isDate($scope.timeEnd)&&($scope.timeEnd=new Date($scope.timeEnd).setHours(23,59,59,999)/1e3),setAttribute("api.options.timeEnd",$scope.timeEnd)),$scope.timeStart&&$scope.timeEnd&&$scope.timeStart>$scope.timeEnd||$scope.collection.fetch().then(function(response){})},$scope.getSiteOrVendorName=function(invoice,siteList,vendorList){var siteName="Site Not Found",sites=("SitetheoryHostingBundle:Site"===invoice.owningIdentity?siteList:vendorList)||[];return sites.length>0&&sites.forEach(function(site){site.id===invoice.owningIdentityId&&(siteName=site.name)}),siteName},$scope.getTags=function(contentId,tagList){var tags=[];return tagList&&tagList.length>0?(tagList.forEach(function(tag){contentId===tag.assets[0].id&&-1===tags.indexOf($scope.upperFirst(tag.name))&&tags.push($scope.upperFirst(tag.name))}),"("+tags.toString()+")"):(Stratus.Environment.get("production")||Array.isArray(tagList)||console.warn("tagList is not an array"),"")},$scope.upperFirst=function(string){return string.charAt(0).toUpperCase()+string.slice(1)},$scope.search=function(collection,query){var results=collection.filter(query);return Promise.resolve(results).then(function(value){var response=[];return value.InvoiceProduct&&(response=response.concat(value.InvoiceProduct)),response})}}]});