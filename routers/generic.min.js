!function(e,t){"function"==typeof define&&define.amd?define(["stratus","underscore","backbone"],t):t(e.Stratus,e._,e.Backbone)}(this,function(e,t,n){e.Routers.Generic=n.Router.extend({routes:{"new/:entity":"new","filter/:entity":"filter","filter/:entity/:filter":"filter","page/:entity":"paginate","page/:entity/:page":"paginate"},initialize:function(t){e.Environment.get("production")||console.info("Generic Router Invoked!")},change:function(t){e.Environment.get("production")||console.log("Model(s):",arguments)},new:function(n){e.Environment.get("production")||console.log("Route New:",arguments);var o=e.Collections.get(t.ucfirst(n));"object"==typeof o&&(this.navigate("#"),o.create(t.has(o,"prototype")?o.prototype:{},{wait:!0}))},filter:function(n,o){void 0===o&&(o="");var i=e.Collections.get(t.ucfirst(n));"object"==typeof i&&(o.startsWith("[]")&&(o=(o=o.substring(2)).split(",[]")),e.Environment.get("production")||console.info("Route Filter:",o),i.meta.set("api.q",o),i.meta.has("api.p")&&i.meta.set("api.p",1),i.refresh({reset:!0}))},paginate:function(n,o){void 0===o&&(o="1"),e.Environment.get("production")||console.log("Entity:",n,"Page:",o);var i=e.Collections.get(t.ucfirst(n));"object"==typeof i?i.isHydrated()?i.meta.has("pageCurrent")&&i.meta.get("pageCurrent")!==parseInt(o)&&(i.meta.get("pageTotal")>=parseInt(o)&&parseInt(o)>=1?(i.meta.set("api.p",o),i.refresh({reset:!0})):e.Environment.get("production")||console.log("Page",o,"of entity",n,"does not exist.")):i.once("reset",function(){this.paginate(n,o)},this):e.Collections.once("change:"+t.ucfirst(n),function(){this.paginate(n,o)},this)}})});