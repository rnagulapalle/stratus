!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular"],factory):factory(root.Stratus,root._,root.angular)}(this,function(Stratus,_,angular){Stratus.Directives.Src=function($parse,$interpolate){return{restrict:"A",scope:{src:"@src",stratusSrc:"@stratusSrc"},link:function($scope,$element){Stratus.Instances[_.uniqueId("src_")]=$scope,$scope.whitelist=["jpg","jpeg","png"],$scope.filter=null,$scope.registered=!1,$scope.register=function(){if($scope.registered)return!0;var ext=$element.attr("src")?$element.attr("src").match(/\.([0-9a-z]+)(\?.*)?$/i):null;return ext&&(ext=ext[1]?ext[1].toLowerCase():null),$scope.filter=_.filter($scope.whitelist,function(value){return ext===value}),!_.size($scope.filter)||(!!$scope.registered||($scope.registered=!0,$element.attr("data-src","lazy"),$scope.group={method:Stratus.Internals.LoadImage,el:$element,spy:$element.data("spy")?Stratus($element.data("spy")):$element},Stratus.RegisterGroup.add("OnScroll",$scope.group),Stratus.Internals.LoadImage($scope.group),void Stratus.Internals.OnScroll()))},$scope.src=$scope.src||$scope.stratusSrc,$scope.interpreter=$interpolate($scope.src,!1,null,!0),$scope.initial=$scope.interpreter($scope.$parent),angular.isDefined($scope.initial)&&($element.attr("src",$scope.initial),$scope.register()),$scope.$watch("stratusSrc",function(value){angular.isDefined(value)&&($element.attr("src",value),$scope.register())})}}}});