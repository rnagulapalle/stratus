!function(t,e){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","stratus.services.model"],e):e(t.Stratus,t._,t.angular)}(this,function(t,e,n){t.Services.Details=["$provide",function(t){t.factory("details",["$http","Model","$interpolate","$q",function(t,a,i,r){return function(){this.fetch=function(t,a){var s=this;return new r(function(r,o){n.isString(t)&&(t={target:t});var c={selectedId:t.attr?t.attr("data-selectedId"):t.selectedId,property:t.attr?t.attr("data-property"):t.property},d=0;a.$watch(function(){return d},function(t){e.isNumber(t)&&parseInt(t)===e.size(c)&&r(s.build(c,a))}),e.each(c,function(t,e){if(t&&n.isString(t)){var r=i(t,!1,null,!0),s=r(a.$parent);n.isDefined(s)?(c[e]=s,d++):a.$watch(function(){return r(a.$parent)},function(t){t&&(c[e]=t,d++)})}else d++})})},this.build=function(e,a){if(e.selectedId){var i;"version.layout"===e.property&&(i="/Api/Layout/"+e.selectedId),"version.template"===e.property&&(i="/Api/Template/"+e.selectedId);t({method:"GET",url:i,headers:{}}).then(function(t){200===t.status&&n.isObject(t.data)&&(a.convoyDetails=t.data.payload||t.data,a.selectedName=a.convoyDetails.name,a.selectedDesc=a.convoyDetails.description)})}}}}])}]});