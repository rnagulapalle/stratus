!function(e,t){"function"==typeof define&&define.amd?define(["stratus","underscore","jquery","angular","stratus.services.utility"],t):t(e.Stratus,e._,e.jQuery,e.angular)}(this,function(e,t,r,n){e.Services.Media=["$provide",function(e){e.factory("media",["$q","$http","$mdDialog","Upload","utility",function(e,n,a,o,i){var u="/Api/Tag",d="/Api/Media";return{dragenter:function(e){r("#main").addClass("blurred")},dragleave:function(e){r("#main").removeClass("blurred")},createTag:function(e){return i.sendRequest(e,"POST",u)},uploadToS3:l,deleteMedia:function(e){return i.sendRequest(null,"DELETE",d+"/"+e)},updateMedia:function(e,t){return i.sendRequest(t,"PUT",d+"/"+e)},getMedia:function(e){var t=e.collection.meta.data.pagination.pageCurrent;return null==t?e.collection.fetch():e.collection.page(t)},fileUploader:function(e,t){return e.errorMsg=null,e.errorUpload=!1,e.progress=0,e.upload=l(e,t),e.upload.then(function(t){e.result=t.data,e.errorUpload=!1},function(t){e.errorUpload=!0,!0===t.config.data.file.upload.aborted?e.errorMsg="Aborted":e.errorMsg="Server Error! Please try again"}),e.upload.progress(function(t){e.progress=0===t.total?0:Math.min(100,parseInt(100*t.loaded/t.total))}),e},saveMediaUrl:function(e){return i.sendRequest(e,"POST",d)},fetchOneMedia:function(e){return i.sendRequest(null,"GET",d+"/"+e)}};function l(e,r){var n="//app.sitetheory.io:3000/?session="+t.cookie("SITETHEORY")+(r?"&id="+r:"");return o.upload({url:n,method:"POST",data:{key:e.name,acl:"private","Content-Type":""!==e.type?e.type:"application/octet-stream",filename:e.name,file:e}})}}])}]});