!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","angular-material","stratus.services.collection","stratus.services.utility"],factory):factory(root.Stratus,root._,root.angular)}(this,function(Stratus,_,angular){Stratus.Components.MenuLink={bindings:{menuLink:"=",versionData:"="},require:"ngModel",transclude:{view:"?stratusEditView",input:"?stratusEditInput"},scope:{elementId:"@",ngModel:"=",property:"@",type:"@",prefix:"@",suffix:"@",stratusEditable:"@",alwaysEdit:"@",autoSave:"@",froalaOptions:"="},controller:function($q,$scope,$attrs,$element,$mdPanel,Collection,utility,$timeout,$window){utility.componentInitializer(this,$scope,$attrs,"menu_link",!0);var $ctrl=this;function finishEdit(){accept(),setEdit(!1)}function setEdit(bool){$ctrl.allowEdit=bool||!1}function handleKeyup($event){switch($event.keyCode){case 13:accept();break;case 27:$ctrl.value=$ctrl.menuLink.name,setEdit(!1)}setTimeCustom()}function accept(){$ctrl.allowEdit&&($ctrl.menuLink.name=$ctrl.value,setTimeCustom(),setEdit(!1))}function setTimeCustom(){$ctrl.versionData.timeCustom=Math.round((new Date).getTime()/1e3)}function show($event){if($ctrl.allowEdit){var position=$mdPanel.newPanelPosition().relativeTo($element).addPanelPosition($mdPanel.xPosition.OFFSET_END,$mdPanel.yPosition.ALIGN_TOPS);$mdPanel.open({attachTo:angular.element(document.body),templateUrl:Stratus.BaseUrl+"sitetheorystratus/stratus/components/menuLinkDialog"+(Stratus.Environment.get("production")?".min":"")+".html",panelClass:"dialogueContainer",position:position,openFrom:$event,clickOutsideToClose:!0,escapeToClose:!1,focusOnOpen:!1,locals:{menuLink:$ctrl.menuLink,versionData:$ctrl.versionData.meta.links},controller:function($scope,mdPanelRef,menuLink,versionData){var dc=this;function close(){mdPanelRef&&(accept(),mdPanelRef.close())}function toggle(){null===menuLink.status||0===menuLink.status?menuLink.status=1:menuLink.status=0,setTimeCustom()}function destroy(){versionData.splice(versionData.indexOf(menuLink),1),setTimeCustom()}function addChild(){var childLink={name:"Untitled Child",parent:{id:$ctrl.versionData.meta.id},nestParent:{id:menuLink.id}};versionData.push(childLink),setTimeCustom()}function changePriority(priority){dc.menuLink.priority=(dc.menuLink.priority||0)+priority,setTimeCustom()}function getContentForMenu(query,target,urlRoot){var collection=new Collection;return collection.target=target,collection.urlRoot=urlRoot,collection.filter(query).then(function(response){return response})}function handleSelection(query,type){switch(type){case"content":dc.menuLink.url=null,dc.menuLink.content=query.data;break;case"url":dc.menuLink.url=query,dc.menuLink.content=null;break;case"menulink":query&&query.data&&dc.menuLink.nestParent&&(dc.menuLink.nestParent.id=query.data.id)}setTimeCustom()}dc.$onInit=function(){dc.menuLink=menuLink,menuLink.nestParent&&(dc.nestParent=function(parentId){var i;if(menuLink.nestParent)for(i=0;i<versionData.length;i++){var link=versionData[i];if(menuLink.nestParent.id===link.id)return link}}(menuLink.nestParent.id)),menuLink.content?dc.linkTo=menuLink.content.version:menuLink.url&&(dc.linkTo=menuLink.url),dc.close=close,dc.toggle=toggle,dc.destroy=destroy,dc.addChild=addChild,dc.changePriority=changePriority,dc.getContentForMenu=getContentForMenu,dc.handleSelection=handleSelection}},controllerAs:"ctrl"})}}$ctrl.$onInit=function(){$ctrl.showDialog=!1,$ctrl.allowEdit=!1,$ctrl.value=$ctrl.menuLink.name,$ctrl.setEdit=setEdit,$ctrl.accept=accept,$ctrl.handleKeyup=handleKeyup,$ctrl.show=show,$ctrl.finishEdit=finishEdit}},templateUrl:Stratus.BaseUrl+"sitetheorystratus/stratus/components/menuLink"+(Stratus.Environment.get("production")?".min":"")+".html"}});