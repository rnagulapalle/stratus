!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","angular-material"],factory):factory(root.Stratus,root._,root.angular)}(this,function(Stratus,_,angular){require(["//maps.googleapis.com/maps/api/js?v=3&key="+Stratus.Api.GoogleMaps],function(){console.log("map loaded!")}),Stratus.Components.Map={transclude:!0,bindings:{elementId:"@"},controller:function($scope,$element,$attrs,$log){this.uid=_.uniqueId("map_"),Stratus.Instances[this.uid]=$scope,$scope.elementId=$attrs.elementId||this.uid,$scope.location=null,$scope.map=null,$scope.tile=256,$scope.createInfoWindowContent=function(latLng,zoom){var scale=1<<zoom,worldCoordinate=$scope.project(latLng);return["Lat/Lng: "+latLng,"Zoom level: "+zoom,"World Coordinate: "+worldCoordinate,"Pixel Coordinate: "+new google.maps.Point(Math.floor(worldCoordinate.x*scale),Math.floor(worldCoordinate.y*scale)),"Tile Coordinate: "+new google.maps.Point(Math.floor(worldCoordinate.x*scale/$scope.tile),Math.floor(worldCoordinate.y*scale/$scope.tile))].join("<br>")},$scope.project=function(latLng){var sinY=Math.sin(latLng.lat()*Math.PI/180);return sinY=Math.min(Math.max(sinY,-.9999),.9999),new google.maps.Point($scope.tile*(.5+latLng.lng()/360),$scope.tile*(.5-Math.log((1+sinY)/(1-sinY))/(4*Math.PI)))},$scope.example=function(){Stratus.Internals.Location().then(function(pos){$scope.location=new google.maps.LatLng(pos.coords.latitude,pos.coords.longitude),$scope.map=new google.maps.Map(document.getElementById("#"+$scope.elementId),{center:$scope.location,zoom:13});var coordInfoWindow=new google.maps.InfoWindow;coordInfoWindow.setContent($scope.createInfoWindowContent($scope.location,$scope.map.getZoom())),coordInfoWindow.setPosition($scope.location),coordInfoWindow.open($scope.map),$scope.map.addListener("zoom_changed",function(){coordInfoWindow.setContent($scope.createInfoWindowContent($scope.location,$scope.map.getZoom())),coordInfoWindow.open($scope.map)})},function(error){$log.error("location:",error.message)})},$scope.example(),$log.log("map:",$element)},template:'<div id="{{ elementId }}" class="loadAnimation">Map Here!</div>'}});