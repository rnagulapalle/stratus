!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","zxcvbn","stratus.services.utility","stratus.services.userAuthentication"],factory):factory(root.Stratus,root._,root.angular,root.zxcvbn)}(this,function(Stratus,_,angular,zxcvbn){Stratus.Components.PasswordReset={binding:{userEmail:"@"},controller:function($scope,$window,$attrs,userAuthentication,utility){utility.componentInitializer(this,$scope,$attrs,"password_reset",!0);var $ctrl=this;$ctrl.resetPassData={},$ctrl.loading=!1,$ctrl.isRequestSuccess=!1;var isRequested=!1;function validPassword(password){return password.length>=8&&/^(?:(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).*)$/.test(password)}function getUrlParams(){var url=new URL($window.location.href);return{type:url.searchParams.get("type"),email:url.searchParams.get("email"),token:url.searchParams.get("token")}}function getStatus(response){return response.data.meta.status[0]}$ctrl.doResetPass=function(resetPassData){$ctrl.loading=!0,isRequested=!0;var data={type:getUrlParams().token?"reset-pasword":"change-password",email:$attrs.userEmail,token:getUrlParams().token,password:resetPassData.password};userAuthentication.resetPass(data).then(function(response){$ctrl.loading=!1,$ctrl.isRequestSuccess=getStatus(response).code===utility.RESPONSE_CODE.success,$ctrl.message=getStatus(response).message})},$scope.$watch(angular.bind(this,function(){if(!isRequested){$ctrl.isRequestSuccess=!1;var password=this.resetPassData.password,confirmPassword=this.resetPassData.confirm_password;return password&&validPassword(password)&&$ctrl.progressBarValue>=40&&($ctrl.message=password!==confirmPassword?"Your password did not match.":null),password}}),function(newValue,oldValue){if(void 0!==newValue&&newValue!==oldValue){var strengthBar=utility.generateStrengthBar(newValue,zxcvbn);$ctrl.progressBarClass=strengthBar.progressBarClass,$ctrl.progressBarValue=strengthBar.progressBarValue,validPassword(newValue)?($ctrl.message=null,$ctrl.allowSubmit=!0):$ctrl.message="Your password must be at 8 or more characters and contain at least one lower and uppercase letter and one number."}})},templateUrl:Stratus.BaseUrl+Stratus.BundlePath+"components/passwordReset"+(Stratus.Environment.get("production")?".min":"")+".html"}});